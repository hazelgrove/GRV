// Generated by js_of_ocaml
//# buildInfo:effects=false, kind=cma, use-js-string=true, version=5.6.0

//# unitInfo: Provides: Incr_select__
(function
  (globalThis){
   "use strict";
   var runtime = globalThis.jsoo_runtime, Incr_select = [0];
   runtime.caml_register_global(0, Incr_select, "Incr_select__");
   return;
  }
  (globalThis));

//# unitInfo: Provides: Incr_select__Incr_select_intf
//# unitInfo: Requires: Expect_test_collector, Ppx_bench_lib__Benchmark_accumulator, Ppx_inline_test_lib__Runtime, Ppx_module_timer_runtime
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Incr_select_Incr_select_in = "Incr_select__Incr_select_intf",
    cst_incr_select = "incr_select";
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    cst = "",
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Expect_test_collector = global_data.Expect_test_collector,
    Ppx_inline_test_lib_Runtime = global_data.Ppx_inline_test_lib__Runtime;
   caml_call1(Ppx_module_timer_runtime[4], cst_Incr_select_Incr_select_in);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][1], cst_incr_select);
   caml_call1(Expect_test_collector[5][1], "src/incr_select_intf.ml");
   caml_call2(Ppx_inline_test_lib_Runtime[2], cst_incr_select, cst);
   caml_call1(Ppx_inline_test_lib_Runtime[3], cst_incr_select);
   caml_call1(Expect_test_collector[5][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Incr_select_Incr_select_in);
   var Incr_select_Incr_select_intf = [0];
   runtime.caml_register_global
    (11, Incr_select_Incr_select_intf, cst_Incr_select_Incr_select_in);
   return;
  }
  (globalThis));

//# unitInfo: Provides: Incr_select
//# unitInfo: Requires: Core, Core__Fn, Core__Hash_set, Core__Hashtbl, Core__List, Core__Option, Expect_test_collector, Ppx_bench_lib__Benchmark_accumulator, Ppx_inline_test_lib__Runtime, Ppx_module_timer_runtime
(function
  (globalThis){
   "use strict";
   var
    runtime = globalThis.jsoo_runtime,
    cst_Incr_select = "Incr_select",
    cst_incr_select = "incr_select";
   function caml_call1(f, a0){
    return (f.l >= 0 ? f.l : f.l = f.length) == 1
            ? f(a0)
            : runtime.caml_call_gen(f, [a0]);
   }
   function caml_call2(f, a0, a1){
    return (f.l >= 0 ? f.l : f.l = f.length) == 2
            ? f(a0, a1)
            : runtime.caml_call_gen(f, [a0, a1]);
   }
   function caml_call3(f, a0, a1, a2){
    return (f.l >= 0 ? f.l : f.l = f.length) == 3
            ? f(a0, a1, a2)
            : runtime.caml_call_gen(f, [a0, a1, a2]);
   }
   function caml_call4(f, a0, a1, a2, a3){
    return (f.l >= 0 ? f.l : f.l = f.length) == 4
            ? f(a0, a1, a2, a3)
            : runtime.caml_call_gen(f, [a0, a1, a2, a3]);
   }
   var
    global_data = runtime.caml_get_global_data(),
    cst = "",
    Core_Hash_set = global_data.Core__Hash_set,
    Core_List = global_data.Core__List,
    Core_Hashtbl = global_data.Core__Hashtbl,
    Core_Option = global_data.Core__Option,
    Core = global_data.Core,
    Core_Fn = global_data.Core__Fn,
    Ppx_module_timer_runtime = global_data.Ppx_module_timer_runtime,
    Ppx_bench_lib_Benchmark_accumu =
      global_data.Ppx_bench_lib__Benchmark_accumulator,
    Expect_test_collector = global_data.Expect_test_collector,
    Ppx_inline_test_lib_Runtime = global_data.Ppx_inline_test_lib__Runtime;
   caml_call1(Ppx_module_timer_runtime[4], cst_Incr_select);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][1], cst_incr_select);
   caml_call1(Expect_test_collector[5][1], "src/incr_select.ml");
   caml_call2(Ppx_inline_test_lib_Runtime[2], cst_incr_select, cst);
   caml_call1(Ppx_inline_test_lib_Runtime[3], cst_incr_select);
   caml_call1(Expect_test_collector[5][2], 0);
   caml_call1(Ppx_bench_lib_Benchmark_accumu[1][2], 0);
   caml_call1(Ppx_module_timer_runtime[5], cst_Incr_select);
   var
    Incr_select =
      [0,
       function(Incr){
        var E = Incr[78], hashtbl_size = 10;
        function setup_generator(hashable, compute_output, make_input_node){
         var
          necessary_dependencies =
            caml_call4(Core_Hashtbl[84][1], 0, [0, hashtbl_size], hashable, 0);
         function make_key_stale(key){
          var
           _w_ = E[2][4],
           _x_ = caml_call2(Core_Hashtbl[53], necessary_dependencies, key),
           _y_ = caml_call2(Core_Option[34], _x_, 0);
          return caml_call2(Core_List[9], _y_, _w_);
         }
         var input_node = caml_call1(make_input_node, make_key_stale);
         caml_call2(Incr[58], input_node, Incr[57][6]);
         function _n_(key){
          var
           input_dep = caml_call2(E[1][2], 0, input_node),
           output_node = [];
          runtime.caml_update_dummy
           (output_node,
            [246,
             function(_o_){
              function _p_(param){return caml_call1(compute_output, key);}
              var
               _q_ =
                 [0,
                  function(is_now_observable){
                   if(is_now_observable){
                    var _r_ = caml_call1(Core[237], output_node);
                    return caml_call3
                            (Core_Hashtbl[78], necessary_dependencies, key, _r_);
                   }
                   function _s_(param){
                    if(! param) return 0;
                    var
                     l = param[1],
                     _t_ = caml_call1(Core[237], output_node),
                     _u_ = caml_call1(Core[246], _t_),
                     _v_ = caml_call1(Core_Fn[2], _u_),
                     l$0 = caml_call2(Core_List[50], l, _v_);
                    return l$0 ? [0, l$0] : 0;
                   }
                   return caml_call3
                           (Core_Hashtbl[37], necessary_dependencies, key, _s_);
                  }];
              return caml_call2(E[2][2], _q_, _p_);
             }]);
          var output_node$0 = caml_call1(Core[237], output_node);
          caml_call2(E[2][6], output_node$0, input_dep);
          return caml_call1(E[2][3], output_node$0);
         }
         return caml_call1(Core[258], _n_);
        }
        function update_one(input, selected, make_stale){
         function _m_(inp){
          caml_call2(Core_Option[41], inp, make_stale);
          caml_call2(Core_Option[41], selected[1], make_stale);
          selected[1] = inp;
          return 0;
         }
         return caml_call2(Incr[9], input, _m_);
        }
        function select_one(H){
         return function(input){
          var selected = [0, 0];
          function compute_output(key){
           var match = selected[1];
           if(! match) return 0;
           var key$0 = match[1], _l_ = caml_call2(H[1], key, key$0);
           return caml_call2(Core[90], _l_, 0);
          }
          function make_input_node(make_key_stale){
           return update_one(input, selected, make_key_stale);
          }
          return setup_generator(H[4], compute_output, make_input_node);};
        }
        function select_one$0(h, input){
         var _k_ = caml_call2(Incr[9], input, Core_Option[53]);
         return select_one(h)(_k_);
        }
        function select_one_value(H){
         return function(default$0, input){
          var selected = [0, 0];
          function compute_output(key){
           var _i_ = selected[1];
           if(! _i_) return default$0;
           var
            match = _i_[1],
            data = match[2],
            key$0 = match[1],
            _j_ = caml_call2(H[1], key, key$0);
           return caml_call2(Core[90], _j_, 0) ? data : default$0;
          }
          function make_input_node(make_key_stale){
           return update_one
                   (input,
                    selected,
                    function(param){
                     var key = param[1];
                     return caml_call1(make_key_stale, key);
                    });
          }
          return setup_generator(H[4], compute_output, make_input_node);};
        }
        function select_one_value$0(h, default$0, input){
         var _h_ = caml_call2(Incr[9], input, Core_Option[53]);
         return select_one_value(h)(default$0, _h_);
        }
        function select_many_values(H){
         return function(default$0, input){
          var
           hashable = H[4],
           selected =
             caml_call4
              (Core_Hashtbl[84][1], 0, [0, hashtbl_size], hashable, 0);
          function compute_output(key){
           var _g_ = caml_call2(Core_Hashtbl[53], selected, key);
           return caml_call2(Core_Option[34], _g_, default$0);
          }
          function make_input_node(make_key_stale){
           function _e_(inp){
            caml_call2(Core_Hashtbl[19], selected, make_key_stale);
            caml_call1(Core_Hashtbl[16], selected);
            function _f_(param){
             var data = param[2], key = param[1];
             caml_call1(make_key_stale, key);
             return caml_call3(Core_Hashtbl[34], selected, key, data);
            }
            return caml_call2(Core_List[9], inp, _f_);
           }
           return caml_call2(Incr[9], input, _e_);
          }
          return setup_generator(hashable, compute_output, make_input_node);};
        }
        function select_many(H){
         return function(input){
          var
           hashable = H[4],
           selected =
             caml_call4
              (Core_Hash_set[38][1], 0, [0, hashtbl_size], hashable, 0);
          function compute_output(key){
           return caml_call2(Core_Hash_set[20], selected, key);
          }
          function make_input_node(make_key_stale){
           function _a_(inp){
            var old_set = caml_call1(Core_Hash_set[21], selected);
            caml_call1(Core_Hash_set[28], selected);
            function _b_(key){
             if(1 - caml_call2(Core_Hash_set[20], old_set, key))
              caml_call1(make_key_stale, key);
             return caml_call2(Core_Hash_set[22], selected, key);
            }
            caml_call2(Core_List[9], inp, _b_);
            function _c_(key){
             var _d_ = 1 - caml_call2(Core_Hash_set[20], selected, key);
             return _d_ ? caml_call1(make_key_stale, key) : _d_;
            }
            return caml_call2(Core_Hash_set[6], old_set, _c_);
           }
           return caml_call2(Incr[9], input, _a_);
          }
          return setup_generator(hashable, compute_output, make_input_node);};
        }
        return [0,
                select_one$0,
                select_one,
                select_one_value$0,
                select_one_value,
                select_many,
                select_many_values];
       }];
   runtime.caml_register_global(17, Incr_select, cst_Incr_select);
   return;
  }
  (globalThis));

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLjAsImZpbGUiOiJpbmNyX3NlbGVjdC5jbWEuanMiLCJzb3VyY2VSb290IjoiIiwibmFtZXMiOlsiaGFzaHRibF9zaXplIiwic2V0dXBfZ2VuZXJhdG9yIiwiaGFzaGFibGUiLCJjb21wdXRlX291dHB1dCIsIm1ha2VfaW5wdXRfbm9kZSIsIm5lY2Vzc2FyeV9kZXBlbmRlbmNpZXMiLCJtYWtlX2tleV9zdGFsZSIsImtleSIsImlucHV0X25vZGUiLCJpbnB1dF9kZXAiLCJvdXRwdXRfbm9kZSIsImlzX25vd19vYnNlcnZhYmxlIiwibCIsImwkMCIsIm91dHB1dF9ub2RlJDAiLCJ1cGRhdGVfb25lIiwiaW5wdXQiLCJzZWxlY3RlZCIsIm1ha2Vfc3RhbGUiLCJpbnAiLCJzZWxlY3Rfb25lIiwiSCIsImtleSQwIiwic2VsZWN0X29uZSQwIiwiaCIsInNlbGVjdF9vbmVfdmFsdWUiLCJkZWZhdWx0JDAiLCJkYXRhIiwic2VsZWN0X29uZV92YWx1ZSQwIiwic2VsZWN0X21hbnlfdmFsdWVzIiwic2VsZWN0X21hbnkiLCJvbGRfc2V0Il0sInNvdXJjZXMiOlsiL1VzZXJzL3N2aXNobnVzLy5vcGFtL2dydi10ZXN0L2xpYi9pbmNyX3NlbGVjdC9pbmNyX3NlbGVjdC5tbCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztFOzs7Ozs7Ozs7Ozs7Rzs7Ozs7Rzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFOzs7Ozs7Ozs7Ozs7Rzs7Ozs7Rzs7Ozs7Rzs7Ozs7Rzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OzswQkFPTUE7aUJBY0FDLGdCQUNHQyxVQUNDQyxnQkFDQUM7U0FHdUI7VUFBekJDO1lBQXlCLHVDQXBCM0JMLGVBZUdFO2tCQU9DSSxlQUFlQztVQUNqQjs7V0FBQSxNQUFBLDZCQUhBRix3QkFFaUJFO1dBQ2pCLE1BQUE7VUFBQSxPQUFBO1NBRWlDO1NBRW5DLElBTkdDLGFBTUgsV0FWSUosaUJBS0FFO1NBU04scUJBVktFO3NCQVdNRDtVQUNUO1dBQUlFLFlBQVksdUJBWmJEO1dB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MUIsV0FiYUQsZ0JBV2FDO1lBRVI7WUFGRyxPQUFBLDZCQVRyQndCO1dBWUg7V0FiZSxPQUFBLG9CQU5oQmY7VUFtQkU7VUFFTixPQXhJRWYsZ0JBcUhFQyxVQUVBQyxnQkFDQUMsaUJBZ0JxRDs7O2dCQXJFdkRtQjtnQkFoQkFIO2dCQW9DQVE7Z0JBakJBSDtnQkEwQ0FLO2dCQXRCQUQ7Ozs7RSIsInNvdXJjZXNDb250ZW50IjpbIm9wZW4gQ29yZVxuXG5tb2R1bGUgTWFrZSAoSW5jciA6IEluY3JlbWVudGFsLlNfZ2VuKSA9IHN0cnVjdFxuICBtb2R1bGUgRSA9IEluY3IuRXhwZXJ0XG5cbiAgKCogSGFzaHRibCBzdGFydHMgb3V0IGF0IGEgcmlkaWN1bG91cyBzaXplIG9mIDEyOC4gVGhpcyBpcyBhIG1vcmUgcmVhc29uYWJsZSBudW1iZXJcbiAgICAgb2YgYmlucyB0byBoYXZlLiAqKVxuICBsZXQgaGFzaHRibF9zaXplID0gMTBcblxuICAoKiogW3NldHVwX2dlbmVyYXRvcl0gc2V0cyB1cCB0aGUgc3RhZ2VkIGNvbnZlcnNpb24uXG5cbiAgICAgIFtoYXNoYWJsZV0gaXMgdXNlZCB0byBidWlsZCBhIHRhYmxlIG9mIG5lY2Vzc2FyeSBkZXBlbmRlbmNpZXMuIFdlIGRyb3AgdW5uZWNlc3NhcnlcbiAgICAgIGRlcGVuZGVuY2llcyB0byBhbGxvdyB0aGVtIHRvIGJlIGNvbGxlY3RlZC5cblxuICAgICAgW2NvbXB1dGVfb3V0cHV0IGtleV0gcmV0dXJucyB0aGUgdmFsdWUgb2YgdGhlIG91dHB1dCBub2RlIGNvcnJlc3BvbmRpbmcgdG8gW2tleV0uXG4gICAgICBbY29tcHV0ZV9vdXRwdXRdIGlzIGNsb3NlZCBvdmVyIHRoZSBtdXRhYmxlIHN0YXRlIGRldGVybWluaW5nIHRoZSBjdXJyZW50IHZhbHVlIG9mXG4gICAgICB0aGUgc2VsZWN0b3IncyBpbnB1dC5cblxuICAgICAgW21ha2VfaW5wdXRfbm9kZV0gbWFrZXMgc3VyZSB0aGF0IHdoZW4gdGhlIG11dGFibGUgc3RhdGUgaW5zaWRlIFtjb21wdXRlX291dHB1dF0gaXNcbiAgICAgIHVwZGF0ZWQsIHRoZSBjb3JyZXNwb25kaW5nIG5vZGVzIGluIHRoZSBbbmVjZXNzYXJ5X2RlcGVuZGVuY2llc10gdGFibGUgYXJlIG1hZGVcbiAgICAgIHN0YWxlLiAgKilcbiAgbGV0IHNldHVwX2dlbmVyYXRvclxuICAgICAgICAoaGFzaGFibGUgOiAnYSBIYXNodGJsX2ludGYuSGFzaGFibGUudClcbiAgICAgICAgfihjb21wdXRlX291dHB1dCA6ICdhIC0+ICdiKVxuICAgICAgICB+KG1ha2VfaW5wdXRfbm9kZSA6IG1ha2Vfa2V5X3N0YWxlOignYSAtPiB1bml0KSAtPiB1bml0IEluY3IudClcbiAgICA6ICgnYSAtPiAnYiBJbmNyLnQpIFN0YWdlZC50XG4gICAgPVxuICAgIGxldCBuZWNlc3NhcnlfZGVwZW5kZW5jaWVzID0gSGFzaHRibC5Vc2luZ19oYXNoYWJsZS5jcmVhdGUgfnNpemU6aGFzaHRibF9zaXplIH5oYXNoYWJsZSAoKSBpblxuICAgIGxldCAoaW5wdXRfbm9kZSA6IHVuaXQgSW5jci50KSA9XG4gICAgICBsZXQgbWFrZV9rZXlfc3RhbGUga2V5ID1cbiAgICAgICAgSGFzaHRibC5maW5kIG5lY2Vzc2FyeV9kZXBlbmRlbmNpZXMga2V5XG4gICAgICAgIHw+IE9wdGlvbi52YWx1ZSB+ZGVmYXVsdDpbXVxuICAgICAgICB8PiBMaXN0Lml0ZXIgfmY6RS5Ob2RlLm1ha2Vfc3RhbGVcbiAgICAgIGluXG4gICAgICBtYWtlX2lucHV0X25vZGUgfm1ha2Vfa2V5X3N0YWxlXG4gICAgaW5cbiAgICAoKiBTZXQgdGhlIGN1dG9mZiBzbyB0aGF0IHdlIG5ldmVyIHBhc3MgYXV0b21hdGljYWxseSBmcm9tIHRoZSB1cGRhdGUgdG8gdGhlIG5vZGVzLiBXZVxuICAgICAgIHdhbnQgZXZlcnl0aGluZyB0byBnbyB0aHJvdWdoIFttYWtlX2tleV9zdGFsZV0gKilcbiAgICBJbmNyLnNldF9jdXRvZmYgaW5wdXRfbm9kZSBJbmNyLkN1dG9mZi5hbHdheXM7XG4gICAgc3RhZ2UgKGZ1biBrZXkgLT5cbiAgICAgIGxldCBpbnB1dF9kZXAgPSBFLkRlcGVuZGVuY3kuY3JlYXRlIGlucHV0X25vZGUgaW5cbiAgICAgIGxldCByZWMgb3V0cHV0X25vZGUgPSBsYXp5IChcbiAgICAgICAgRS5Ob2RlLmNyZWF0ZVxuICAgICAgICAgIChmdW4gKCkgLT4gY29tcHV0ZV9vdXRwdXQga2V5KVxuICAgICAgICAgIH5vbl9vYnNlcnZhYmlsaXR5X2NoYW5nZTooZnVuIH5pc19ub3dfb2JzZXJ2YWJsZSAtPlxuICAgICAgICAgICAgaWYgaXNfbm93X29ic2VydmFibGUgdGhlblxuICAgICAgICAgICAgICBIYXNodGJsLmFkZF9tdWx0aSBuZWNlc3NhcnlfZGVwZW5kZW5jaWVzIH5rZXkgfmRhdGE6KGZvcmNlIG91dHB1dF9ub2RlKVxuICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICBIYXNodGJsLmNoYW5nZSBuZWNlc3NhcnlfZGVwZW5kZW5jaWVzIGtleSB+ZjooZnVuY3Rpb25cbiAgICAgICAgICAgICAgICB8IE5vbmUgLT4gTm9uZVxuICAgICAgICAgICAgICAgIHwgU29tZSBsIC0+XG4gICAgICAgICAgICAgICAgICBtYXRjaCBMaXN0LmZpbHRlciBsIH5mOihGbi5ub24gKHBoeXNfZXF1YWwgKGZvcmNlIG91dHB1dF9ub2RlKSkpIHdpdGhcbiAgICAgICAgICAgICAgICAgIHwgW10gLT4gTm9uZVxuICAgICAgICAgICAgICAgICAgfCBsJyAtPiBTb21lIGwnXG4gICAgICAgICAgICAgICkpKVxuICAgICAgaW5cbiAgICAgIGxldCBvdXRwdXRfbm9kZSA9IGZvcmNlIG91dHB1dF9ub2RlIGluXG4gICAgICBFLk5vZGUuYWRkX2RlcGVuZGVuY3kgb3V0cHV0X25vZGUgaW5wdXRfZGVwO1xuICAgICAgRS5Ob2RlLndhdGNoIG91dHB1dF9ub2RlXG4gICAgKVxuXG4gICgqKiBUaGlzIGNyZWF0ZXMgYSB1bml0IGluY3JlbWVudGFsIHRoYXQgZmlyZXMgd2hlbmV2ZXIgdGhlIGlucHV0IGluY3JlbWVudGFsXG4gICAgICBmaXJlcy4gV2hlbiB0aGF0IG9jY3VycywgaXQgdXBkYXRlcyBbc2VsZWN0ZWRdIHRvIG1hdGNoIHRoZSBjdXJyZW50IHZhbHVlIG9mXG4gICAgICBbaW5wdXRdLCBhbmQgY2FsbHMgW21ha2Vfa2V5X3N0YWxlXSBmb3IgYm90aCB0aGUgb2xkIGFuZCBuZXcgdmFsdWUgb2YgdGhlXG4gICAgICBpbmNyZW1lbnRhbC4gKilcbiAgbGV0IHVwZGF0ZV9vbmUgfmlucHV0IH5zZWxlY3RlZCB+bWFrZV9zdGFsZSA9XG4gICAgSW5jci5tYXAgaW5wdXQgfmY6KGZ1biBpbnAgLT5cbiAgICAgIE9wdGlvbi5pdGVyIGlucCB+ZjptYWtlX3N0YWxlO1xuICAgICAgT3B0aW9uLml0ZXIgIXNlbGVjdGVkIH5mOm1ha2Vfc3RhbGU7XG4gICAgICBzZWxlY3RlZCA6PSBpbnBcbiAgICApXG5cbiAgbGV0IHNlbGVjdF9vbmUnXG4gICAgICAgICh0eXBlIGEpXG4gICAgICAgIChtb2R1bGUgSCA6IEhhc2hhYmxlLkNvbW1vbiB3aXRoIHR5cGUgdCA9IGEpXG4gICAgICAgIChpbnB1dCA6IGEgb3B0aW9uIEluY3IudClcbiAgICA9XG4gICAgbGV0IHNlbGVjdGVkID0gcmVmIE5vbmUgaW5cbiAgICBsZXQgY29tcHV0ZV9vdXRwdXQga2V5ID1cbiAgICAgIG1hdGNoICFzZWxlY3RlZCB3aXRoXG4gICAgICB8IE5vbmUgLT4gZmFsc2VcbiAgICAgIHwgU29tZSBrZXknIC0+IEguY29tcGFyZSBrZXkga2V5JyA9IDBcbiAgICBpblxuICAgIGxldCBtYWtlX2lucHV0X25vZGUgfm1ha2Vfa2V5X3N0YWxlID1cbiAgICAgIHVwZGF0ZV9vbmUgfmlucHV0IH5zZWxlY3RlZCB+bWFrZV9zdGFsZTptYWtlX2tleV9zdGFsZVxuICAgIGluXG4gICAgc2V0dXBfZ2VuZXJhdG9yIEguaGFzaGFibGUgfmNvbXB1dGVfb3V0cHV0IH5tYWtlX2lucHV0X25vZGVcblxuICBsZXQgc2VsZWN0X29uZSBoIGlucHV0ID1cbiAgICBzZWxlY3Rfb25lJyBoIChJbmNyLm1hcCB+ZjpPcHRpb24uc29tZSBpbnB1dClcblxuICBsZXQgc2VsZWN0X29uZV92YWx1ZSdcbiAgICAgICAgKHR5cGUgYSlcbiAgICAgICAgKG1vZHVsZSBIIDogSGFzaGFibGUuQ29tbW9uIHdpdGggdHlwZSB0ID0gYSlcbiAgICAgICAgfmRlZmF1bHRcbiAgICAgICAgaW5wdXRcbiAgICA9XG4gICAgbGV0IHNlbGVjdGVkID0gcmVmIE5vbmUgaW5cbiAgICBsZXQgY29tcHV0ZV9vdXRwdXQga2V5ID1cbiAgICAgIG1hdGNoICFzZWxlY3RlZCB3aXRoXG4gICAgICB8IE5vbmUgLT4gZGVmYXVsdFxuICAgICAgfCBTb21lIChrZXknLCBkYXRhKSAtPiBpZiBILmNvbXBhcmUga2V5IGtleScgPSAwIHRoZW4gZGF0YSBlbHNlIGRlZmF1bHRcbiAgICBpblxuICAgIGxldCBtYWtlX2lucHV0X25vZGUgfm1ha2Vfa2V5X3N0YWxlID1cbiAgICAgIHVwZGF0ZV9vbmUgfnNlbGVjdGVkIH5pbnB1dCB+bWFrZV9zdGFsZTooZnVuIChrZXksIF8pIC0+IG1ha2Vfa2V5X3N0YWxlIGtleSlcbiAgICBpblxuICAgIHNldHVwX2dlbmVyYXRvciBILmhhc2hhYmxlIH5jb21wdXRlX291dHB1dCB+bWFrZV9pbnB1dF9ub2RlXG5cbiAgbGV0IHNlbGVjdF9vbmVfdmFsdWUgaCB+ZGVmYXVsdCBpbnB1dCA9XG4gICAgc2VsZWN0X29uZV92YWx1ZScgaCB+ZGVmYXVsdCAoSW5jci5tYXAgfmY6T3B0aW9uLnNvbWUgaW5wdXQpXG5cbiAgbGV0IHNlbGVjdF9tYW55X3ZhbHVlc1xuICAgICAgICAodHlwZSBhKVxuICAgICAgICAobW9kdWxlIEggOiBIYXNoYWJsZS5Db21tb24gd2l0aCB0eXBlIHQgPSBhKVxuICAgICAgICB+ZGVmYXVsdFxuICAgICAgICBpbnB1dFxuICAgID1cbiAgICBsZXQgaGFzaGFibGUgPSBILmhhc2hhYmxlIGluXG4gICAgbGV0IHNlbGVjdGVkID0gSGFzaHRibC5Vc2luZ19oYXNoYWJsZS5jcmVhdGUgfnNpemU6aGFzaHRibF9zaXplIH5oYXNoYWJsZSAoKSBpblxuICAgIGxldCBjb21wdXRlX291dHB1dCBrZXkgPVxuICAgICAgSGFzaHRibC5maW5kIHNlbGVjdGVkIGtleSB8PiBPcHRpb24udmFsdWUgfmRlZmF1bHRcbiAgICBpblxuICAgIGxldCBtYWtlX2lucHV0X25vZGUgfm1ha2Vfa2V5X3N0YWxlID1cbiAgICAgIEluY3IubWFwIGlucHV0IH5mOihmdW4gaW5wIC0+XG4gICAgICAgIEhhc2h0YmwuaXRlcl9rZXlzIHNlbGVjdGVkIH5mOm1ha2Vfa2V5X3N0YWxlO1xuICAgICAgICBIYXNodGJsLmNsZWFyIHNlbGVjdGVkO1xuICAgICAgICBMaXN0Lml0ZXIgaW5wIH5mOihmdW4gKGtleSwgZGF0YSkgLT5cbiAgICAgICAgICBtYWtlX2tleV9zdGFsZSBrZXk7XG4gICAgICAgICAgSGFzaHRibC5zZXQgc2VsZWN0ZWQgfmtleSB+ZGF0YVxuICAgICAgICApKVxuICAgIGluXG4gICAgc2V0dXBfZ2VuZXJhdG9yIGhhc2hhYmxlIH5jb21wdXRlX291dHB1dCB+bWFrZV9pbnB1dF9ub2RlXG5cbiAgbGV0IHNlbGVjdF9tYW55XG4gICAgICAgICh0eXBlIGEpXG4gICAgICAgIChtb2R1bGUgSCA6IEhhc2hhYmxlLkNvbW1vbiB3aXRoIHR5cGUgdCA9IGEpXG4gICAgICAgIGlucHV0XG4gICAgPVxuICAgIGxldCBoYXNoYWJsZSA9IEguaGFzaGFibGUgaW5cbiAgICBsZXQgc2VsZWN0ZWQgPSBIYXNoX3NldC5Vc2luZ19oYXNoYWJsZS5jcmVhdGUgfnNpemU6aGFzaHRibF9zaXplIH5oYXNoYWJsZSAoKSBpblxuICAgIGxldCBjb21wdXRlX291dHB1dCBrZXkgPSBIYXNoX3NldC5tZW0gc2VsZWN0ZWQga2V5IGluXG4gICAgbGV0IG1ha2VfaW5wdXRfbm9kZSB+bWFrZV9rZXlfc3RhbGUgPVxuICAgICAgSW5jci5tYXAgaW5wdXQgfmY6KGZ1biBpbnAgLT5cbiAgICAgICAgbGV0IG9sZF9zZXQgPSBIYXNoX3NldC5jb3B5IHNlbGVjdGVkIGluXG4gICAgICAgIEhhc2hfc2V0LmNsZWFyIHNlbGVjdGVkO1xuXG4gICAgICAgIExpc3QuaXRlciBpbnAgfmY6KGZ1biBrZXkgLT5cbiAgICAgICAgICBpZiBub3QgKEhhc2hfc2V0Lm1lbSBvbGRfc2V0IGtleSkgdGhlblxuICAgICAgICAgICAgbWFrZV9rZXlfc3RhbGUga2V5O1xuICAgICAgICAgIEhhc2hfc2V0LmFkZCBzZWxlY3RlZCBrZXlcbiAgICAgICAgKTtcblxuICAgICAgICBIYXNoX3NldC5pdGVyIG9sZF9zZXQgfmY6KGZ1biBrZXkgLT5cbiAgICAgICAgICBpZiBub3QgKEhhc2hfc2V0Lm1lbSBzZWxlY3RlZCBrZXkpIHRoZW5cbiAgICAgICAgICAgIG1ha2Vfa2V5X3N0YWxlIGtleTtcbiAgICAgICAgKSlcbiAgICBpblxuICAgIHNldHVwX2dlbmVyYXRvciBoYXNoYWJsZSB+Y29tcHV0ZV9vdXRwdXQgfm1ha2VfaW5wdXRfbm9kZVxuZW5kXG5cbiJdfQ==
